(function(s,n){typeof exports=="object"&&typeof module!="undefined"?n(exports,require("vue"),require("d3-force")):typeof define=="function"&&define.amd?define(["exports","vue","d3-force"],n):(s=typeof globalThis!="undefined"?globalThis:s||self,n(s.VNetworkGraphForceLayout={},s.Vue,s.d3))})(this,function(s,n,d){"use strict";var F=Object.defineProperty,V=Object.defineProperties;var A=Object.getOwnPropertyDescriptors;var D=Object.getOwnPropertySymbols;var B=Object.prototype.hasOwnProperty,G=Object.prototype.propertyIsEnumerable;var w=(s,n,d)=>n in s?F(s,n,{enumerable:!0,configurable:!0,writable:!0,value:d}):s[n]=d,j=(s,n)=>{for(var d in n||(n={}))B.call(n,d)&&w(s,d,n[d]);if(D)for(var d of D(n))G.call(n,d)&&w(s,d,n[d]);return s},E=(s,n)=>V(s,A(n));function P(g){const i=Object.create(null,{[Symbol.toStringTag]:{value:"Module"}});if(g){for(const t in g)if(t!=="default"){const o=Object.getOwnPropertyDescriptor(g,t);Object.defineProperty(i,t,o.get?o:{enumerable:!0,get:()=>g[t]})}}return i.default=g,Object.freeze(i)}const x=P(d);class O{constructor(i={}){this.options=i}activate(i){const{nodePositions:t,nodes:o,edges:c,emitter:a}=i;let{nodeLayouts:h,nodeLayoutMap:p}=this.buildNodeLayouts(o.value,t);const v=this.createSimulation(h,this.forceLayoutEdges(c.value,o.value));this.onTick=()=>{var r,y,u,e,l;for(const f of h){const k=(r=t.value)==null?void 0:r[f.id];if(k){const S=(y=f.x)!=null?y:0,T=(u=f.y)!=null?u:0;(k.x!==S||k.y!==T)&&Object.assign(k,{x:S,y:T})}else t.value[f.id]={x:(e=f.x)!=null?e:0,y:(l=f.y)!=null?l:0}}},v.on("tick",this.onTick),this.onTick();const m=()=>{this.options.noAutoRestartSimulation||v.alpha(.1).restart()},b=r=>{var y;if(this.options.noAutoRestartSimulation)for(const[u,e]of Object.entries(r)){const l=(y=t.value)==null?void 0:y[u];l.x=e.x,l.y=e.y}else{for(const[u,e]of Object.entries(r)){const l=p[u];l.fx=e.x,l.fy=e.y}m()}},L=r=>{var y;for(const[u,e]of Object.entries(r)){const l=this.getNodeLayout(t,u),f=(y=p==null?void 0:p[u])!=null?y:{x:0,y:0};l.value.fixed||this.options.positionFixedByDrag?(f.fx=e.x,f.fy=e.y,l.value.fixed=!0):(f.x=e.x,f.y=e.y,delete f.fx,delete f.fy)}m()},N=({node:r,event:y})=>{if(this.options.positionFixedByClickWithAltKey&&y.altKey){const u=this.getNodeLayout(t,r);let e=p==null?void 0:p[r];e||(e={id:r,x:0,y:0},p[r]=e),u.value.fixed?(delete u.value.fixed,e.x=e.fx||e.x,e.y=e.fy||e.y,delete e.fx,delete e.fy):(u.value.fixed=!0,e.fx=e.x,e.fy=e.y),m()}},C=n.watch(()=>[Object.keys(o.value),Object.keys(t.value),Object.values(c.value).map(r=>`${r.source}=${r.target}`)],()=>{({nodeLayouts:h,nodeLayoutMap:p}=this.buildNodeLayouts(o.value,t)),v.nodes(h);const r=v.force("edge");r&&r.links(this.forceLayoutEdges(c.value,o.value)),m()});a.on("node:dragstart",b),a.on("node:pointermove",b),a.on("node:dragend",L),a.on("node:click",N),this.onDeactivate=()=>{v.stop(),C(),a.off("node:dragstart",b),a.off("node:pointermove",b),a.off("node:dragend",L),a.off("node:click",N)}}deactivate(){this.onDeactivate&&this.onDeactivate(),this.onTick=void 0}ticked(){var i;(i=this.onTick)==null||i.call(this)}createSimulation(i,t){if(this.options.createSimulation)return this.options.createSimulation(x,i,t);{const o=x.forceLink(t).id(c=>c.id);return x.forceSimulation(i).force("edge",o.distance(100)).force("charge",x.forceManyBody()).force("collide",x.forceCollide(50).strength(.2)).force("center",x.forceCenter().strength(.05)).alphaMin(.001)}}buildNodeLayouts(i,t){const o=Object.keys(i).filter(h=>!(h in t.value)),c=this.forceNodeLayouts(t.value,o),a=Object.fromEntries(c.map(h=>[h.id,h]));return{nodeLayouts:c,nodeLayoutMap:a}}forceNodeLayouts(i,t){const o=Object.entries(i).map(([c,a])=>a.fixed?E(j({id:c},a),{fx:a.x,fy:a.y}):j({id:c},a));return t.map(c=>({id:c})).forEach(c=>o.push(c)),o}forceLayoutEdges(i,t){return Object.values(i).filter(o=>o.source in t&&o.target in t).map(o=>({source:o.source,target:o.target}))}getNodeLayout(i,t){const o=n.toRef(i.value,t);return o.value||(o.value={x:0,y:0}),o}}globalThis.VNetworkGraph&&Object.assign(globalThis.VNetworkGraph,{ForceLayout:O});const _={ForceLayout:O};s.default=_,Object.defineProperties(s,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});
//# sourceMappingURL=force-layout.js.map
